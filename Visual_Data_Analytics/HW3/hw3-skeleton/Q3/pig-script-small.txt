-- ################################
-- ### Load Data. DO NOT CHANGE ###
-- ################################
yellow_raw = LOAD 's3://nyc-tlc/trip data/yellow_tripdata_2019*' USING PigStorage(',') AS (vendor:int, pickup_datetime:chararray, dropoff_datetime:chararray, passenger_count:int, trip_distance:float, ratecode:int, store_and_fwd_flag:chararray, PULocationID:int, DOLocationID:int, payment_type:int, fare_amount:float, extra:float, tip_amount:float, tolls_amount:float, improvement_surcharge:float, total_amount:float, congestion_surcharge:float);
yellow = FILTER yellow_raw by pickup_datetime != 'tpep_pickup_datetime';

green_raw = LOAD 's3://nyc-tlc/trip data/green_tripdata_2019*' USING PigStorage(',') AS (vendor: int, pickup_datetime:chararray, dropoff_datetime:chararray, store_and_fwd_flag:chararray, ratecode:int, PULocationID:int, DOLocationID:int, passenger_count:int, trip_distance:float, fare_amount:float, extra:float, mta_tax:float, tip_amount:float, tolls_amount:float, ehail_fee:float, improvement_surcharge:float, total_amount:float, payment_type:int, trip_type:int, congestion_surchage:float);
green = FILTER green_raw BY pickup_datetime != 'lpep_pickup_datetime';

locations_raw = LOAD 's3://nyc-tlc/misc/taxi _zone_lookup.csv' USING PigStorage(',') AS (LocationID:int, Borough:chararray, Zone:chararray, service_zone:chararray);
locations = FOREACH locations_raw GENERATE $0, REPLACE($1, '"', '') AS Borough, REPLACE($2, '"', '') AS Zone;
-- ################################

-- ################################
-- ### Put additional code below:
-- ################################
green_filter= FILTER green BY trip_distance >= 2.0;
yellow_filter = FILTER yellow BY trip_distance >= 2.0;

union_data = UNION green_filter, yellow_filter;

taxi = FOREACH union_data GENERATE $0 AS vendor, $1 AS pickup_datetime, $2 AS dropoff_datetime, $3 AS passenger_count, $4 AS trip_distance, $5 AS ratecode, $6 AS store_and_fwd_flag, $7 AS PULocationID, $8 AS DOLocationID, $9 AS payment_type, $10 AS fare_amount, $11 AS extra, $12 AS tip_amount, $13 AS tolls_amount, $14 AS improvement_surcharge, $15 AS total_amount, $16 AS congestion_surcharge;


yellow: {vendor: int,pickup_datetime: chararray,dropoff_datetime: chararray,passenger_count: int,trip_distance: float,ratecode: int,store_and_fwd_flag: chararray,
PULocationID: int,DOLocationID: int,payment_type: int,fare_amount: float,extra: float,tip_amount: float,tolls_amount: float,improvement_surcharge: float,total_amount: float,
congestion_surcharge: float}